

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Simple Imitation Learning &mdash; DI-drive 0.3.4 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Simple Reinforcement Learning" href="rl_tutorial.html" />
    <link rel="prev" title="Auto policy running and visualization" href="auto_run.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> DI-drive
          

          
          </a>

          
            
            
              <div class="version">
                0.3.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="core_concepts.html">Core Concepts and Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="carla_tutorial.html">Carla tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_run.html">Auto policy running and visualization</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Simple Imitation Learning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#datasets-collection">Datasets collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-training">Model training</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-evaluation">Model evaluation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rl_tutorial.html">Simple Reinforcement Learning</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../features/index.html">Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../model_zoo/index.html">Model Zoo</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_doc/index.html">API Doc</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DI-drive</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorial</a> &raquo;</li>
        
      <li>Simple Imitation Learning</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorial/il_tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="simple-imitation-learning">
<span id="header-n2"></span><h1>Simple Imitation Learning<a class="headerlink" href="#simple-imitation-learning" title="Permalink to this heading">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>Here we will show you how to use <strong>DI-drive</strong> for imitation learning research
of autopilot. <strong>DI-drive</strong> supports
<a class="reference external" href="http://vladlen.info/papers/conditional-imitation.pdf">Conditional Imitation Learning(CIL)</a>
and its inheritor for Imitation Learning research.</p>
<p>In this tutorial, we will show how to use <strong>DI-drive</strong> to train a CILRS model.
CILRS takes front RGB camera and vehicle speed as input, then output the prediction of vehicle control singals including
steer, throttle and brake under certain navigation command, together with a speed prediction.</p>
<p>Imitation Learning normally includes three parts:</p>
<ul class="simple">
<li><p>Collecting expert driving datasets</p></li>
<li><p>Training driving model</p></li>
<li><p>Close-loop evaluation under driving curcumstance</p></li>
</ul>
<p>For now, we will show you step by step. All demo codes can be found in <code class="docutils literal notranslate"><span class="pre">demo/cilrs</span></code></p>
<section id="datasets-collection">
<span id="header-n14"></span><h2>Datasets collection<a class="headerlink" href="#datasets-collection" title="Permalink to this heading">¶</a></h2>
<p>To collect expert data, the first step is to start Carla servers</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./CarlaUE4.sh<span class="w"> </span>-fps<span class="o">=</span><span class="m">10</span><span class="w"> </span>-benchmark<span class="w"> </span>-world-port<span class="o">=[</span>PORT<span class="w"> </span>NUM<span class="o">]</span>
</pre></div>
</div>
<p>To customize your training datasets, please refer to the configuration and entry demo in
<code class="docutils literal notranslate"><span class="pre">cilrs_data_collect.py</span></code>. It use an auto-driving policy to run in Carla benchmark ‘suite’.
For this tutorial, you need to change the suite name, dataset path and Carla server host/port.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">server</span><span class="o">=</span><span class="p">[</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">carla_host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">carla_ports</span><span class="o">=</span><span class="p">[</span><span class="mi">9000</span><span class="p">,</span> <span class="mi">9010</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
<span class="p">],</span>
<span class="n">policy</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">collect</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">n_episode</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">dir_path</span><span class="o">=</span><span class="s1">&#39;path_to_your_dataset&#39;</span><span class="p">,</span>
        <span class="n">collector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">suite</span><span class="o">=</span><span class="s1">&#39;suite_name&#39;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Then you can use the python scrips to collect the data.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>cilrs_data_collect.py
</pre></div>
</div>
<p>This collecting process of 100 episodes may cost ~7 hours and ~12 G storage with
single Carla server. You can speed up this process by starting multi-carla servers.</p>
<p>The dataset format is illustrated in the <a class="reference external" href="../features/datasets.html">benchmark datasets</a>.
The CILRS demo builds preload files to speed up the loading of dataset. If you finished
this step, there should be an <code class="docutils literal notranslate"><span class="pre">.npy</span></code> file under <code class="docutils literal notranslate"><span class="pre">_preloads</span></code>.</p>
<p>We recommend to collect both training and validating datasets with different suite to get
better performance.</p>
<p>Once you finish the data collection, the next step is to train an CILRS model.</p>
</section>
<section id="model-training">
<span id="header-n26"></span><h2>Model training<a class="headerlink" href="#model-training" title="Permalink to this heading">¶</a></h2>
<p>The training part of IL enables a model to mimic the
output of an expert policy with the same input. To apply the model training
with <strong>DI-drive</strong> with default training configuration, just run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">cilrs_train</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Note that you should modify the dataset path and preload path as you have created
above.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">train</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">root_dir</span><span class="o">=</span><span class="s1">&#39;path_to_your_train_dataset&#39;</span><span class="p">,</span>
        <span class="n">preloads</span><span class="o">=</span><span class="s1">&#39;path_to_your_train_preloads&#39;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">val</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">root_dir</span><span class="o">=</span><span class="s1">&#39;path_to_your_val_dataset&#39;</span><span class="p">,</span>
        <span class="n">preloads</span><span class="o">=</span><span class="s1">&#39;path_to_your_val_preloads&#39;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
</pre></div>
</div>
<p>You will see training procedure shown on the screen like this.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/image-il_1.png"><img alt="image-il_1" src="../_images/image-il_1.png" style="width: 600px;" /></a>
</figure>
<p>The training checkpoints will be saved under <code class="docutils literal notranslate"><span class="pre">checkpoints</span></code> folder. The
training process will last for 7~8 hours (i7-9900k and GeForce RTX 2080Ti), up to your machine hardware.</p>
<p>if you want to customize your training configuration such as the model architecture and
learning rates, please modify the config in <code class="docutils literal notranslate"><span class="pre">cilrs_train.py</span></code></p>
</section>
<section id="model-evaluation">
<span id="header-n35"></span><h2>Model evaluation<a class="headerlink" href="#model-evaluation" title="Permalink to this heading">¶</a></h2>
<p>We provide benchmark evaluation and close-loop test in environment (mostly for visualization) for
a trained CILRS model with <strong>DI-drive</strong>. To evaluate your trained model, just run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>cilrs_eval.py
</pre></div>
</div>
<p>Note that you may need to change the checkpoint path and Carla server host/port in <code class="docutils literal notranslate"><span class="pre">cilrs_eval.py</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">server</span><span class="o">=</span><span class="p">[</span>
   <span class="nb">dict</span><span class="p">(</span><span class="n">carla_host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">carla_ports</span><span class="o">=</span><span class="p">[</span><span class="mi">9000</span><span class="p">,</span> <span class="mi">9010</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="p">],</span>
<span class="n">policy</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">ckpt_path</span><span class="o">=</span><span class="s1">&#39;path_to_your_ckpt&#39;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When the evaluation is finished, you will get a performance table.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/image-il_2.png"><img alt="image-il_2" src="../_images/image-il_2.png" style="width: 800px;" /></a>
</figure>
<p>Also, you can visual the real-time close-loop test by running</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">cilrs_test</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>You can see a visualized screen of the running policy.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/image-il_3.png"><img alt="image-il_3" src="../_images/image-il_3.png" style="width: 500px;" /></a>
</figure>
<p>You can customize the evaluation and test configuration by modifying the config in
<code class="docutils literal notranslate"><span class="pre">cilrs_eval.py</span></code> and <code class="docutils literal notranslate"><span class="pre">cilrs_test.py</span></code></p>
<p>Congratulations! You have finished the imitation learning tutorial.</p>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rl_tutorial.html" class="btn btn-neutral float-right" title="Simple Reinforcement Learning" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="auto_run.html" class="btn btn-neutral float-left" title="Auto policy running and visualization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, OpenDILab

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>