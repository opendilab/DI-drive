

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Learning by Cheating &mdash; DI-drive 0.3.4 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="from Continuous Intention to Continuous Trajectory" href="cict.html" />
    <link rel="prev" title="Conditional Imitation Learning" href="cilrs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> DI-drive
          

          
          </a>

          
            
            
              <div class="version">
                0.3.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../features/index.html">Features</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Model Zoo</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#imitation-learning-model-zoo">Imitation Learning Model Zoo</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="cilrs.html">Conditional Imitation Learning</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Learning by Cheating</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#datasets-collection">Datasets collection</a></li>
<li class="toctree-l4"><a class="reference internal" href="#model-training">Model training</a></li>
<li class="toctree-l4"><a class="reference internal" href="#model-evaluation">Model evaluation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#model-testing">Model testing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cict.html">from Continuous Intention to Continuous Trajectory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#reinforcement-learning-model-zoo">Reinforcement Learning Model Zoo</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#other-method">Other Method</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_doc/index.html">API Doc</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DI-drive</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Model Zoo</a> &raquo;</li>
        
      <li>Learning by Cheating</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/model_zoo/lbc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="learning-by-cheating">
<h1>Learning by Cheating<a class="headerlink" href="#learning-by-cheating" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="https://arxiv.org/abs/1912.12294">Learning by Cheating(LBC)</a>
is an Imitation Learning method which driving in Carla using waypoint prediction and
two-stage training – cheating model and target model. The cheating model takes
ground-truth Bird-eye View(BeV) image as input to teach the RGB input target policy.
The prediction of the model is a waypoint list then the waypoint list is processed by
a PID controller to get the final control signals including steer,
throttle and brake.</p>
<figure class="align-center" id="id1">
<img alt="image-lbc_1" src="../_images/image-lbc_1.png" />
<figcaption>
<p><span class="caption-text">LBC structure</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>DI-drive</strong> provide complete pipeline of training an LBC privileged model and target
model, including data collection, birdview model training, image model training, mimicing
cheating model and evaluation. All entries can be found in <code class="docutils literal notranslate"><span class="pre">demo/lbc</span></code></p>
<section id="datasets-collection">
<h2>Datasets collection<a class="headerlink" href="#datasets-collection" title="Permalink to this heading">¶</a></h2>
<p><strong>DI-drive</strong> provides benchmark data collection for LBC. The dataset is formatted to save
rgb data as <cite>.png</cite> files and BeV data into <cite>.lmdb</cite> files. The configuration of dataset
collection is set up in <code class="docutils literal notranslate"><span class="pre">lbc_collect_data.py</span></code>. You may need to change the Carla server,
dataset path, collection suites, planner configs and noise args etc.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">env</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">env_num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">simulator</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">planner</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="o">...</span>
            <span class="p">),</span>
            <span class="o">...</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="n">server</span><span class="o">=</span><span class="p">[</span>
        <span class="nb">dict</span><span class="p">(</span><span class="n">carla_host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">carla_ports</span><span class="o">=</span><span class="p">[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">5010</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
    <span class="p">],</span>
    <span class="n">policy</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">target_speed</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
        <span class="n">noise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">noise_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="o">...</span>
        <span class="p">),</span>
        <span class="n">collect</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">dir_path</span><span class="o">=</span><span class="s1">&#39;./datasets_train/lbc_datasets_train&#39;</span><span class="p">,</span>
            <span class="n">n_episode</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">collector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">suite</span><span class="o">=</span><span class="s1">&#39;FullTown01-v1&#39;</span><span class="p">,</span>
                <span class="n">nocrash</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="o">...</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>You may need to change the Carla server numbers and ports, and dataset path to yours.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>collect_data.py
</pre></div>
</div>
</section>
<section id="model-training">
<h2>Model training<a class="headerlink" href="#model-training" title="Permalink to this heading">¶</a></h2>
<p>The training of LBC model contains 3 stages: training privileged model, offline
training target model, on-line fine-tuning target model.</p>
<section id="training-privileged-model">
<h3>Training privileged model<a class="headerlink" href="#training-privileged-model" title="Permalink to this heading">¶</a></h3>
<p>The training of privileged model is a supervise learning procedure. You can check
the training code in <code class="docutils literal notranslate"><span class="pre">lbc_birdview_train.py</span></code>. By default it will save checkpoint
and tensorboard logs in <code class="docutils literal notranslate"><span class="pre">./log</span></code>. You can check the training progress and effects.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">lbc_birdview_train</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</section>
<section id="offline-training-target-model">
<h3>Offline training target model<a class="headerlink" href="#offline-training-target-model" title="Permalink to this heading">¶</a></h3>
<p>The off-line training of target model consists of 2 procedures, first warm-up training
with dataset label, then mimicing with privileged model label. Both training codes are
provided in <code class="docutils literal notranslate"><span class="pre">lbc_img_train_phase0.py</span></code> and <code class="docutils literal notranslate"><span class="pre">lbc_img_train_phase1.py</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">lbc_img_train_phase0</span><span class="o">.</span><span class="n">py</span>
<span class="n">python</span> <span class="n">lbc_img_train_phase1</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>You may need to change the dataset path, checkpoint path etc.</p>
</section>
<section id="online-training-target-model">
<h3>Online training target model<a class="headerlink" href="#online-training-target-model" title="Permalink to this heading">¶</a></h3>
<p>Pending</p>
</section>
</section>
<section id="model-evaluation">
<h2>Model evaluation<a class="headerlink" href="#model-evaluation" title="Permalink to this heading">¶</a></h2>
<p>DI-drive provides benchmark evaluation for both cheating model and target model,
together with pre-trained weights. You may need to change the Carla server settings
to yours.</p>
<p>Pretrain weights:
<a class="reference external" href="http://opendilab.org/download/DI-drive/lbc/birdview/model-256.th">bev</a>,
<a class="reference external" href="http://opendilab.org/download/DI-drive/lbc/rgb/model-20.th">image</a></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>lbc_bev_eval.py
python<span class="w"> </span>lbc_image_eval.py
</pre></div>
</div>
<p>Then you will get the performance table.</p>
</section>
<section id="model-testing">
<h2>Model testing<a class="headerlink" href="#model-testing" title="Permalink to this heading">¶</a></h2>
<p>DI-drive provides a simple entry for testing LBC models in a benchmark or Casezoo
environment and visualize the running. You may need to change the Carla server settings
to yours.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>lbc_bev_test.py
python<span class="w"> </span>lbc_image_test.py
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@inproceedings</span><span class="p">{</span><span class="n">chen2019lbc</span><span class="p">,</span>
  <span class="n">author</span>    <span class="o">=</span> <span class="p">{</span><span class="n">Dian</span> <span class="n">Chen</span> <span class="ow">and</span> <span class="n">Brady</span> <span class="n">Zhou</span> <span class="ow">and</span> <span class="n">Vladlen</span> <span class="n">Koltun</span> <span class="ow">and</span> <span class="n">Philipp</span> <span class="n">Kr</span>\<span class="s2">&quot;ahenb</span><span class="se">\&quot;</span><span class="s2">uhl},</span>
  <span class="n">title</span>     <span class="o">=</span> <span class="p">{</span><span class="n">Learning</span> <span class="n">by</span> <span class="n">Cheating</span><span class="p">},</span>
  <span class="n">booktitle</span> <span class="o">=</span> <span class="p">{</span><span class="n">Conference</span> <span class="n">on</span> <span class="n">Robot</span> <span class="n">Learning</span> <span class="p">(</span><span class="n">CoRL</span><span class="p">)},</span>
  <span class="n">year</span>      <span class="o">=</span> <span class="p">{</span><span class="mi">2019</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cict.html" class="btn btn-neutral float-right" title="from Continuous Intention to Continuous Trajectory" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cilrs.html" class="btn btn-neutral float-left" title="Conditional Imitation Learning" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, OpenDILab

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>