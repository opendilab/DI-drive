

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Policy Features &mdash; DI-drive 0.3.4 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Visualization" href="visualize.html" />
    <link rel="prev" title="Carla Simulator Features" href="simulator_feature.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> DI-drive
          

          
          </a>

          
            
            
              <div class="version">
                0.3.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorial</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Features</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="simulator_feature.html">Carla Simulator Features</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Policy Features</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="visualize.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="datasets.html">Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="carla_benchmark.html">Carla Benchmark Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="casezoo.html">Carla Scenario and Casezoo Evaluation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../model_zoo/index.html">Model Zoo</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_doc/index.html">API Doc</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DI-drive</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Features</a> &raquo;</li>
        
      <li>Policy Features</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/features/policy_feature.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="policy-features">
<h1>Policy Features<a class="headerlink" href="#policy-features" title="Permalink to this heading">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>Policy is defined as an instance to run forward with observation as input and action as output. Basically it should
have these interfaces: <code class="docutils literal notranslate"><span class="pre">init</span></code>, <code class="docutils literal notranslate"><span class="pre">reset</span></code> and <code class="docutils literal notranslate"><span class="pre">forward</span></code>.
DI-drive defines policy in a more complex but powerful way. One policy can have different running modes,
in order to be suitable for various kinds of training and test procedures, i.e. a Reinforcement Learning policy
may act differently when sampling data and evaluating, a Supervised Learning policy may have different outputs
when labels are not equal to control signal.
As a result of this, DI-drive follows the policy definition of
<a class="reference external" href="https://github.com/opendilab/DI-engine">DI-engine</a> which defines
three modes: <em>collect</em>, <em>eval</em> and <em>learn</em>. Different modes of policy may have different
behavior but share some core modules such as a Neural Network computation graph, and can be
called with the same interfaces.</p>
<p>DI-drive makes this work by defining policy’s property of each mode, in which it maps a set of functions in
policy with interfaces that can be directly called by the user. For example, calling <code class="docutils literal notranslate"><span class="pre">forward</span></code> method of a
<code class="docutils literal notranslate"><span class="pre">policy.collect_mode</span></code> is the same as calling <code class="docutils literal notranslate"><span class="pre">policy._forward_collect</span></code> method. Same as <code class="docutils literal notranslate"><span class="pre">init</span></code>, <code class="docutils literal notranslate"><span class="pre">reset</span></code>,
<code class="docutils literal notranslate"><span class="pre">state_dict</span></code> and <code class="docutils literal notranslate"><span class="pre">load_state_dict</span></code>. This makes the policy polymorphic under the same core computing logic.</p>
<figure class="align-center">
<img alt="policy_mode" src="../_images/policy_mode.png" />
</figure>
<p>After that, it is natural to use the same policy with different modes in some worker instances to realize various
functions during training, collecting and evaluating etc. What is more, users are allowed to design their own
policy mode in this way. Just keep the external interface <code class="docutils literal notranslate"><span class="pre">init</span></code>, <code class="docutils literal notranslate"><span class="pre">reset</span></code> and <code class="docutils literal notranslate"><span class="pre">forward</span></code> (<code class="docutils literal notranslate"><span class="pre">state_dict</span></code> as
optional) able to be called as usual.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_policy</span> <span class="o">=</span> <span class="n">MyPolicy</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># collection data</span>
<span class="n">collector</span><span class="o">.</span><span class="n">policy</span> <span class="o">=</span> <span class="n">my_policy</span><span class="o">.</span><span class="n">collect_mode</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">collector</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">n_sample</span><span class="o">=...</span><span class="p">)</span>

<span class="c1"># evaluation</span>
<span class="n">evaluator</span><span class="o">.</span><span class="n">policy</span> <span class="o">=</span> <span class="n">my_policy</span><span class="o">.</span><span class="n">eval_mode</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">suite</span><span class="o">=...</span><span class="p">)</span>

<span class="c1"># training</span>
<span class="n">learner</span><span class="o">.</span><span class="n">policy</span> <span class="o">=</span> <span class="n">my_policy</span><span class="o">.</span><span class="n">learn_mode</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">learner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_data</span><span class="o">=...</span><span class="p">)</span>
</pre></div>
</div>
<p>DI-drive uses DI-engine’s <code class="docutils literal notranslate"><span class="pre">EnvManager</span></code> to sample data in parallel. One policy should be able to handle data
from several environments when computing forward. For NN model, this is done by put all data together as a
batch and run forward for one time. For the other model like PID controller, the policy should store internal
information for each environment to run correctly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">env_manager</span> <span class="o">=</span> <span class="n">BaseEnvManager</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">my_policy</span> <span class="o">=</span> <span class="n">MyPolicy</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">xxx_mode</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">env_manager</span><span class="o">.</span><span class="n">ready_obs</span>
<span class="c1"># obs is a dict contains observation in several environments like {env_id: obs, ...}</span>
<span class="n">actions</span> <span class="o">=</span> <span class="n">my_policy</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
<span class="c1"># policy should return a dict with all actions of environments in the passed obs dict, like {env_id: action, ...}</span>
</pre></div>
</div>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="visualize.html" class="btn btn-neutral float-right" title="Visualization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="simulator_feature.html" class="btn btn-neutral float-left" title="Carla Simulator Features" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, OpenDILab

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>